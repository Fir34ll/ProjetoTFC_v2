<!DOCTYPE HTML>
<html>
<head>
    <title>Recomendações de Investimento</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="static/css/main.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    
    <style>
        .recommendations-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #000000;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .investment-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .investment-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .stock-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .stock-card:hover {
            transform: translateY(-5px);
        }
        .stock-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 15px;
        }
        .stock-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        .stock-symbol {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .stock-price {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stock-change {
            font-size: 0.9em;
            padding: 3px 8px;
            border-radius: 12px;
        }
        .stock-change.positive {
            background-color: #e6ffe6;
            color: #008000;
        }
        .stock-change.negative {
            background-color: #ffe6e6;
            color: #ff0000;
        }
        .stock-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        .tips-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .tips-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .tips-list {
            list-style: disc;
            padding-left: 20px;
        }
        .tips-list li {
            margin-bottom: 10px;
            color: #555;
        }
        .profile-warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .profile-warning a {
            color: #0056b3;
            text-decoration: underline;
        }
        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #666;
        }
        .loading i {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .investment-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 24px;
            margin-top: 16px;
        }
        .investment-card-modern {
            background: linear-gradient(135deg, #f8fafc 60%, #e0e7ef 100%);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.07);
            padding: 28px 22px 22px 22px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            position: relative;
            transition: box-shadow 0.2s, transform 0.2s;
            border: 1.5px solid #e5e7eb;
        }
        .investment-card-modern:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.13);
            transform: translateY(-4px) scale(1.02);
        }
        .investment-icon {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #2563eb;
        }
        .investment-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #22223b;
            margin-bottom: 6px;
        }
        .investment-desc {
            color: #4b5563;
            font-size: 1rem;
            margin-bottom: 14px;
        }
        .investment-allocation {
            background: #2563eb;
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 8px;
            padding: 4px 14px;
            align-self: flex-end;
            margin-top: auto;
            box-shadow: 0 2px 8px rgba(37,99,235,0.08);
        }
        .add-to-wallet-btn {
            margin-top: 16px;
            background: #10b981;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(16,185,129,0.08);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .add-to-wallet-btn:hover {
            background: #059669;
        }
    </style>
</head>
<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
        <button class="back-button" onclick="window.location.href='index'">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
        </button>
        <!-- Main -->
        <div id="main">
            <div class="inner">
                <!-- Header -->
                <header id="header">
                    <a href="recomendacoes" class="logo"><strong>Recomendações de Investimento</strong></a>
                </header>

                <!-- Content -->
                <section>
                    <div class="recommendations-container">
                        <!-- Aviso para quem ainda não fez o questionário -->
                        <div id="profileWarning" class="profile-warning" style="display: none;">
                            <p>Você ainda não realizou o questionário de perfil de investidor.</p>
                            <p>Para receber recomendações personalizadas, <a href="perfilinvestidor">clique aqui</a> para fazer o questionário.</p>
                        </div>

                        <!-- Conteúdo das recomendações -->
                        <div id="recommendationsContent">
                            <div class="investment-card">
                                <h3>Seu Perfil de Investidor</h3>
                                <p id="profileType" class="text-xl font-bold mb-4"></p>
                                <p id="profileDescription" class="text-gray-600"></p>
                            </div>

                            <div class="investment-card">
                                <h3>Recomendações de Investimentos</h3>
                                <div id="investmentsList" class="investment-cards-grid">
                                    <!-- As recomendações serão inseridas aqui via JavaScript -->
                                </div>
                            </div>

                            <div class="investment-card">
                                <h3>Ações Recomendadas</h3>
                                <div id="stocksGrid" class="stocks-grid">
                                    <div class="loading">
                                        <i class="fas fa-spinner"></i> Carregando informações das ações...
                                    </div>
                                </div>
                            </div>

                            <div class="tips-section">
                                <h3>Dicas Importantes</h3>
                                <ul id="tipsList" class="tips-list">
                                    <!-- As dicas serão inseridas aqui via JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="static/assets/js/jquery.min.js"></script>
    <script src="static/assets/js/browser.min.js"></script>
    <script src="static/assets/js/breakpoints.min.js"></script>
    <script src="static/assets/js/util.js"></script>
    <script src="static/assets/js/main.js"></script>

    <script>
        // Função para formatar números
        function formatNumber(number) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(number);
        }

        // Função para formatar porcentagem
        function formatPercentage(number) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'percent',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(number / 100);
        }

        // Função para extrair símbolos das ações das recomendações
        function extractStockSymbols(description) {
            const matches = description.match(/\(([A-Z0-9]+)\)/g);
            if (!matches) return [];
            return matches.map(match => match.slice(1, -1));
        }

        // Função para carregar as recomendações
        function loadRecommendations() {
            fetch('/get_investor_profile')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('profileWarning').style.display = 'block';
                        document.getElementById('recommendationsContent').style.display = 'none';
                    } else {
                        document.getElementById('profileWarning').style.display = 'none';
                        document.getElementById('recommendationsContent').style.display = 'block';
                        
                        // Atualiza o tipo de perfil e descrição
                        document.getElementById('profileType').textContent = `Investidor ${data.result}`;
                        document.getElementById('profileDescription').textContent = data.recommendations.description;

                        // Atualiza a lista de investimentos
                        const investmentsList = document.getElementById('investmentsList');
                        investmentsList.innerHTML = data.recommendations.investments.map(inv => `
                            <div class="investment-card-modern">
                                ${getInvestmentIcon(inv.name)}
                                <div class="investment-title">${inv.name}</div>
                                <div class="investment-desc">${inv.description}</div>
                                <div class="investment-allocation">${inv.allocation}</div>
                            </div>
                        `).join('');

                        // Atualiza a lista de dicas
                        const tipsList = document.getElementById('tipsList');
                        tipsList.innerHTML = data.recommendations.tips.map(tip => `
                            <li>${tip}</li>
                        `).join('');

                        // Coleta todos os símbolos de ações das recomendações
                        const allSymbols = new Set();
                        data.recommendations.investments.forEach(inv => {
                            const symbols = extractStockSymbols(inv.description);
                            symbols.forEach(symbol => allSymbols.add(symbol));
                        });

                        // Busca informações das ações
                        if (allSymbols.size > 0) {
                            fetch('/get_stock_info', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    symbols: Array.from(allSymbols)
                                })
                            })
                            .then(response => response.json())
                            .then(stockData => {
                                const stocksGrid = document.getElementById('stocksGrid');
                                if (stockData.stocks && stockData.stocks.length > 0) {
                                    stocksGrid.innerHTML = stockData.stocks.map(stock => `
                                        <div class="stock-card">
                                            <img src="${stock.logo}" alt="${stock.name}" class="stock-logo" onerror="this.src='static/svg/stock-placeholder.svg'">
                                            <div class="stock-name">${stock.name}</div>
                                            <div class="stock-symbol">${stock.symbol}</div>
                                            <div class="stock-price">${formatNumber(stock.price)}</div>
                                            <div class="stock-change ${stock.change >= 0 ? 'positive' : 'negative'}">
                                                ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                                            </div>
                                            <div class="stock-info">
                                                <div><strong>Máxima do dia:</strong> ${stock.dayHigh !== null ? formatNumber(stock.dayHigh) : 'N/A'}</div>
                                                <div><strong>Mínima do dia:</strong> ${stock.dayLow !== null ? formatNumber(stock.dayLow) : 'N/A'}</div>
                                                <div><strong>Volume:</strong> ${stock.volume !== null ? stock.volume.toLocaleString('pt-BR') : 'N/A'}</div>
                                                <div><strong>Valor de mercado:</strong> ${stock.marketCap !== null ? formatNumber(stock.marketCap) : 'N/A'}</div>
                                                <div><strong>P/L:</strong> ${stock.priceEarnings !== null ? stock.priceEarnings : 'N/A'}</div>
                                                <div><strong>EPS:</strong> ${stock.earningsPerShare !== null ? stock.earningsPerShare : 'N/A'}</div>
                                            </div>
                                            <button class="add-to-wallet-btn" onclick="addToWallet('${stock.symbol}')">
                                                <i class="fas fa-plus-circle"></i> Adicionar à Carteira
                                            </button>
                                        </div>
                                    `).join('');
                                } else {
                                    stocksGrid.innerHTML = '<p class="text-center">Não foi possível carregar as informações das ações.</p>';
                                }
                            })
                            .catch(error => {
                                console.error('Erro ao carregar informações das ações:', error);
                                document.getElementById('stocksGrid').innerHTML = 
                                    '<p class="text-center text-red-500">Erro ao carregar informações das ações.</p>';
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar recomendações:', error);
                });
        }

        // Carrega as recomendações quando a página é carregada
        document.addEventListener('DOMContentLoaded', loadRecommendations);

        // Função para mapear ícones para tipos de investimento
        function getInvestmentIcon(name) {
            if (name.toLowerCase().includes('ação') && name.toLowerCase().includes('dividendo')) return '<i class="fas fa-coins investment-icon"></i>';
            if (name.toLowerCase().includes('ação')) return '<i class="fas fa-chart-line investment-icon"></i>';
            if (name.toLowerCase().includes('fundo')) return '<i class="fas fa-building investment-icon"></i>';
            if (name.toLowerCase().includes('tesouro')) return '<i class="fas fa-piggy-bank investment-icon"></i>';
            if (name.toLowerCase().includes('cdb')) return '<i class="fas fa-university investment-icon"></i>';
            if (name.toLowerCase().includes('lci') || name.toLowerCase().includes('lca')) return '<i class="fas fa-leaf investment-icon"></i>';
            return '<i class="fas fa-briefcase investment-icon"></i>';
        }

        function addToWallet(symbol) {
            window.location.href = `/indexcarteira?symbol=${encodeURIComponent(symbol)}`;
        }
    </script>
</body>
</html> 